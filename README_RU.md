# Fresh Flowers
![](https://shields.microej.com/badge/python-3.10-orange)
![](https://shields.microej.com/badge/aiogram-v3.1.1-lightblue)
![](https://shields.microej.com/badge/django-v4.2.7-blue)
![](https://img.shields.io/pypi/v/asyncpg?style=flat&label=acyncpg)


## Описание
Fresh Flowers - это телеграм бот для заказа цветов.\
Можно оформить заказ, выбрав понравившиеся товары в пути или в наличии, также можно в свободной форме описать предзаказ. Для оформления заказа также необходимо указать контактные данные,
после чего заявка отправляется менеджеру в следующем виде:\
\
<img src="https://bytepix.ru/ib/TlLcMVChCp.jpg" width=400>

### ТЗ от заказчика
После совместного обсуждения были определены следующие основные требования к проекту:
1. Возможность добавления/редактирования/удаления позиций онлайн
2. Разделение позиций на товары в пути/наличии в зависимости от даты прибытия, указанной при добавлении товара
3. Реализовать корзину с возможностью добавления/удаления товаров пользователем
4. Возможность загрузки товаров через excel таблицу определенного формата
5. Сбор статистики о количестве пользователей, посетивших бота

### Выбранные решения для реализации требований
Пройдемся конкретно по каждому пункту из подраздела выше:
1. В качестве платформы для добавления/редактирования/удаления позиций было решено использовать встроенную в django административную панель. Были созданы модели для товаров в пути/наличии
с необходимыми полями <p align="center"><img src="https://bytepix.ru/ib/FCdZQCYUHN.png" width=600></p>
3.  Для автоматического переноса товаров, при достижении даты прибытия, используется daemon процесс, который каждые 15 минут сравнивает дату прибытия товара из таблицы "Товары в пути"
с текущей датой. Если дата прибытия меньше текущей даты - товар переносится в таблицу "Товары в наличии"
5.  Корзина реализована путем создания таблицы в БД, в которую добавляются товары с привязкой к id пользователя в телеграме
6.  Для возможности загрузки товаров через excel таблицу определенного формата была создана форма с проверкой авторизации пользователя сайта в административной панели django.
Также разработан алгоритм по обработке загружаемой таблицы и занесению информации в БД
7. Была создана модель, в которую заносятся данные о пользователе при нажатии на кнопку "Start" в боте

Бот написан на асинхронном фреймворке aiogram, запущен на хостинге [beget](https://beget.com), в качестве БД используется PostgreSQL с использованием асинхронного драйвера asyncpg.
## Локальный запуск проекта
Выполните клонирование проекта и установите необходимые для работы зависимости:
```
git clone https://github.com/skojpish/freshflowers.git
pip install -r requirements.txt
```
Создайте файл .env по пути /freshflowers/bot/ со следующим наполнением:
```
TOKEN = 'токен телеграм бота'
MASTER_ID = 'телеграм айди аккаунта для заявок'
MASTER_USERNAME = 'телеграм юзернейм аккаунта для заявок'
DB_USER = 'логин базы данных'
DB_PASSWORD = 'пароль базы данных'
DB_NAME = 'название БД'
```
Выполните миграции django проекта для создания моделей в вашей БД:
```
cd django_admin/proj
python manage.py makemigrations
python manage.py migrate
```
Создайте нового супер пользователя для django admin:
```
python manage.py createsuperuser
```
Запустите django проект:
```
python manage.py runserver
```
Запустите бота:
```
cd ../..
python main.py
```
